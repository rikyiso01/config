FROM jupyter/tensorflow-notebook

USER root
RUN echo 'jovyan ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers
USER jovyan

# Dependencies
RUN sudo apt-get update &&\
    sudo apt-get install -y --no-install-recommends apt-transport-https wget gpg &&\
    wget -qO- https://dl-ssl.google.com/linux/linux_signing_key.pub | sudo gpg --dearmor -o /usr/share/keyrings/dart.gpg &&\
    echo 'deb [signed-by=/usr/share/keyrings/dart.gpg arch=amd64] https://storage.googleapis.com/download.dartlang.org/linux/debian stable main' | sudo tee /etc/apt/sources.list.d/dart_stable.list &&\
    sudo apt-get update &&\
    sudo apt-get install -y --no-install-recommends dotnet6 php php-cli php-zmq rust-src rustc cargo dart postgresql &&\
    sudo apt-get install -y --no-install-recommends openjdk-18-jdk-headless &&\
    sudo rm -rf /var/lib/apt/lists/* &&\
    sudo apt-get clean

# C#
ENV PATH=$PATH:/home/jovyan/.dotnet/tools
RUN dotnet tool install -g Microsoft.dotnet-interactive && dotnet interactive jupyter install

# PHP
ENV PATH=$PATH:/home/jovyan/.config/composer/vendor/bin
RUN wget -qO composer-setup.php https://getcomposer.org/installer &&\
    sudo php composer-setup.php --install-dir=/usr/local/bin/ --filename composer &&\
    rm composer-setup.php &&\
    composer global require rabrennie/jupyter-php-kernel &&\
    jupyter-php-kernel --install

# Java
RUN wget -qO ijava.zip https://github.com/SpencerPark/IJava/releases/download/v1.3.0/ijava-1.3.0.zip &&\
    unzip ijava.zip &&\
    python3 install.py --user &&\
    rm -rf ijava.zip install.py

# Bash
RUN pip install bash_kernel && python -m bash_kernel.install

# C++
ENV PATH=$PATH:/home/jovyan/cling_2020-11-05_ROOT-ubuntu2004/bin
RUN wget -qO cling.tar.bz2 https://root.cern.ch/download/cling/cling_2020-11-05_ROOT-ubuntu2004.tar.bz2 &&\
    tar -xf cling.tar.bz2 &&\
    rm -rf cling.tar.bz2 &&\
    cd cling_2020-11-05_ROOT-ubuntu2004/share/cling/Jupyter/kernel &&\
    pip install -e . &&\
    jupyter-kernelspec install --user cling-cpp17

# Typescript
RUN npm install -g tslab && tslab install

# Kotlin
RUN pip install kotlin-jupyter-kernel && python -m kotlin_kernel add-kernel

# Rust
RUN wget -qO evcxr.tar.gz https://github.com/google/evcxr/releases/download/v0.14.0/evcxr_jupyter-v0.14.0-x86_64-unknown-linux-gnu.tar.gz &&\
    tar -xf evcxr.tar.gz &&\
    rm -rf evcxr.tar.gz &&\
    evcxr_jupyter-v0.14.0-x86_64-unknown-linux-gnu/evcxr_jupyter --install

# Dart
ENV PYTHONPATH=/home/jovyan/jupyter-dart-kernel-master
RUN wget -qO dart.zip https://github.com/vickumar1981/jupyter-dart-kernel/archive/refs/heads/master.zip &&\
    unzip dart.zip &&\
    rm -rf dart.zip &&\
    jupyter kernelspec install jupyter-dart-kernel-master --user

# Elm
RUN wget -qO elm.gz https://github.com/elm/compiler/releases/download/0.19.1/binary-for-linux-64-bit.gz &&\
    gunzip elm.gz &&\
    rm -rf elm.gz &&\
    chmod +x elm &&\
    sudo mv elm /usr/local/bin/ &&\
    pip install elm_kernel &&\
    python -m elm_kernel.install

#Postgres
#%load_ext sql
#from subprocess import run;run("sudo /etc/init.d/postgresql start",shell=True);
#%sql postgresql://postgres:jovyan@localhost
RUN pip install ipython-sql sqlalchemy psycopg2-binary &&\
    sudo /etc/init.d/postgresql start && sudo -u postgres psql -c "alter user postgres password 'jovyan'"

# Disables authentication
RUN jupyter lab --generate-config && echo "c.NotebookApp.token = 'jovyan'" >> /home/jovyan/.jupyter/jupyter_lab_config.py

EXPOSE 8888