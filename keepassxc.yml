app-id: org.chromium.Chromium.Extension.KeepassXC
# This should match the extension point version
branch: "1"
runtime: org.chromium.Chromium
runtime-version: stable
sdk: org.freedesktop.Sdk//22.08
build-extension: true
appstream-compose: false

modules:
  - name: native-messaging-hosts
    buildsystem: simple
    build-commands:
      - mkdir -p ${FLATPAK_DEST}/bin
      - install -Dm755 keepassxc-proxy ${FLATPAK_DEST}/bin
      - mkdir -p ${FLATPAK_DEST}/native-messaging-hosts
      - |
        echo '{
          "allowed_origins": [
              "chrome-extension://pdffhmdngciaglkoonimfcmckehcpafo/",
              "chrome-extension://oboonakemofpalcgghocfoadofidjkkk/"
          ],
          "description": "KeePassXC integration with native messaging support",
          "name": "org.keepassxc.keepassxc_browser",
          "path": "'${FLATPAK_DEST}/bin/keepassxc-proxy'",
          "type": "stdio"
        }' > ${FLATPAK_DEST}/native-messaging-hosts/org.keepassxc.keepassxc_browser.json
    sources:
      - type: file
        filename: keepassxc-proxy
        url: https://github.com/rugk/keepassxc-proxy-rust/releases/download/211ae91/keepassxc-proxy
        sha256: c5c4c6c011a4d64f7e4dd6c444dcc70bee74d23ffb28c9b65f7ff6d89a8f86ea
        size: 361752
